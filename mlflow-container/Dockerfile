FROM python:3.10

ARG DB_NAME_ARG
ARG DB_PASSWORD_ARG
ARG DB_ENDPOINT_ARG
ARG DB_USER_ARG
ARG S3_BUCKET_NAME_ARG

ENV DB_NAME=${DB_NAME_ARG}
ENV DB_PASSWORD=${DB_PASSWORD_ARG}
ENV DB_ENDPOINT=${DB_ENDPOINT_ARG}
ENV DB_USER=${DB_USER_ARG}
ENV S3_BUCKET_NAME=${S3_BUCKET_NAME_ARG}

RUN pip3 install mlflow==2.12.1 psycopg2-binary==2.9.9 boto3==1.34.96

EXPOSE 5000

CMD ["sh", "-c","mlflow server -h 0.0.0.0 -p 5000 --backend-store-uri postgresql://${DB_USER}:${DB_PASSWORD}@${DB_ENDPOINT}:5432/${DB_NAME} --default-artifact-root ${S3_BUCKET_NAME}"]